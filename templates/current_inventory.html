{% extends "base.html" %}
{% block content %}

<h2>Current Inventory</h2>

<form method="GET" class="inventory-search">
    <input type="hidden" name="sort" value="{{ sort_column }}">
    <input type="hidden" name="direction" value="{{ sort_direction }}">
    <input
        type="text"
        name="search"
        placeholder="Search by item number or name"
        value="{{ search_term }}"
    >
    <button type="submit">Search</button>
    {% if search_term %}
    <a class="clear-button" href="{{ url_for('current_inventory') }}">Clear</a>
    {% endif %}
</form>

<table>
    <tr>
        <th>
            <a href="{{ url_for('current_inventory', sort='item_number', direction='desc' if sort_direction != 'desc' or sort_column != 'item_number' else 'asc', search=search_term) }}">
                Item Number
            </a>
        </th>
        <th>
            <a href="{{ url_for('current_inventory', sort='name', direction='desc' if sort_direction != 'desc' or sort_column != 'name' else 'asc', search=search_term) }}">
                Name
            </a>
        </th>
        <th>Quantity</th>
        <th>Allocated</th>
        <th>Available</th>
        <th>Unit</th>
        <th>Lot</th>
        <th>Supplier</th>
        <th>EXP</th>
    </tr>

    {% for item in items %}
    <tr>
        <td>{{ item[0] }}</td>
        <td>{{ item[1] }}</td>
        <td>{{ item[2] }}</td>
        <td>{{ item[7] }}</td>
        <td>{{ item[8] }}</td>
        <td>{{ item[3] }}</td>
        <td>{{ item[4] }}</td>
        <td>{{ item[5] }}</td>
        <td>{{ item[6] }}</td>
    </tr>
    {% endfor %}
</table>

{% if purchases %}
<h3>Purchased (On the Way)</h3>
<table>
    <tr>
        <th>Item Number</th>
        <th>Name</th>
        <th>Quantity</th>
        <th>Unit</th>
        <th>Lot</th>
        <th>Supplier</th>
        <th>EXP</th>
        <th>Action</th>
    </tr>
    {% for purchase in purchases %}
    <tr>
        <td>{{ purchase[1] }}</td>
        <td>{{ purchase[2] }}</td>
        <td>{{ purchase[3] }}</td>
        <td>{{ purchase[4] }}</td>
        <td>{{ purchase[5] }}</td>
        <td>{{ purchase[6] }}</td>
        <td>{{ purchase[7] }}</td>
        <td>
            <form method="POST" action="/purchases/deliver">
                <input type="hidden" name="purchase_id" value="{{ purchase[0] }}">
                <button type="submit">Mark Delivered</button>
            </form>
        </td>
    </tr>
    {% endfor %}
</table>
{% endif %}

{% endblock %}
